<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for scripts/controllers/register.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">all files</a> / <a href="index.html">scripts/controllers/</a> register.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">7.94% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>5/63</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/20</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">8.33% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>1/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">7.94% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>5/63</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">(function() {
  'use strict';
&nbsp;
  /**
   * @ngdoc controller
   * @name daiictSenTeam13App.controller:RegisterCtrl
   * @description
   * Controller of the daiictSenTeam13App
   */
  angular.module('daiictSenTeam13App')
    .controller('RegisterCtrl', ['$scope', '$location', '$timeout', <span class="fstat-no" title="function not covered" >function($scope, $location, $timeout) {</span>
<span class="cstat-no" title="statement not covered" >      var ref = new Firebase('https://sfip.firebaseio.com/');</span>
<span class="cstat-no" title="statement not covered" >      var self = this;</span>
<span class="cstat-no" title="statement not covered" >      var password = 'pass';</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      $location.url($location.path());</span>
&nbsp;
      /**
       * @ngdoc function
       * @name daiictSenTeam13App.controller:RegisterCtrl#resetValues
       * @methodOf daiictSenTeam13App.controller:RegisterCtrl
       * @description
       * Resets all the input fields that were filled by the user who
       * is attempting to register on the portal.
       * @returns {undefined} Does not return anything.
       */
<span class="fstat-no" title="function not covered" >      function resetValues() {</span>
<span class="cstat-no" title="statement not covered" >        $scope.email = '';</span>
<span class="cstat-no" title="statement not covered" >        $scope.firstName = '';</span>
<span class="cstat-no" title="statement not covered" >        $scope.lastName = '';</span>
<span class="cstat-no" title="statement not covered" >        $scope.userType = 'student';</span>
<span class="cstat-no" title="statement not covered" >        $scope.institute = '';</span>
      }
<span class="cstat-no" title="statement not covered" >      resetValues();</span>
&nbsp;
      /**
       * @ngdoc function
       * @name daiictSenTeam13App.controller:RegisterCtrl#sendPassword
       * @methodOf daiictSenTeam13App.controller:RegisterCtrl
       * @param {string} email Email address with which the user registered.
       * @description
       * Sends an email to reset the passworf for given email address. In case
       * of an error, raises appropriate toasts.
       * @returns {undefined} Does not return anything.
       */
<span class="fstat-no" title="function not covered" >      function sendPassword(email) {</span>
<span class="cstat-no" title="statement not covered" >        ref.resetPassword({</span>
          email: email
        }, <span class="fstat-no" title="function not covered" >function(error) {</span>
<span class="cstat-no" title="statement not covered" >          if (error) {</span>
<span class="cstat-no" title="statement not covered" >            switch (error.code) {</span>
              case "INVALID_USER":
<span class="cstat-no" title="statement not covered" >                Materialize.toast("The specified user account does not exist.", 4000);</span>
<span class="cstat-no" title="statement not covered" >                break;</span>
              default:
<span class="cstat-no" title="statement not covered" >                Materialize.toast("Error resetting password:" + error, 4000);</span>
            }
          }
        });
      }
&nbsp;
      /**
       * @ngdoc function
       * @name daiictSenTeam13App.controller:RegisterCtrl#validate
       * @methodOf daiictSenTeam13App.controller:RegisterCtrl
       * @description
       * Validation function to check inputs given by user who is attempting
       * to register. Validation checks performed are:
       * 1. Email address should be of the domain "daiict.ac.in" else a toast
       *    is displayed asking user to use only that domain's address.
       * 2. All fields must be filled else a toast message is displayed alerting
       *    the user that all fields are necessary.
       * If validation test passes, 'true' is returned to the signup function
       * else false is returned.
       * @returns {undefined} Does not return anything.
       */
<span class="fstat-no" title="function not covered" >      function validate() {</span>
<span class="cstat-no" title="statement not covered" >        if ($scope.email.indexOf('@daiict.ac.in') &lt; 0) { //verifications add</span>
<span class="cstat-no" title="statement not covered" >          Materialize.toast('Please use DAIICT email address.', 4000);</span>
<span class="cstat-no" title="statement not covered" >          resetValues();</span>
<span class="cstat-no" title="statement not covered" >          return false;</span>
        }
<span class="cstat-no" title="statement not covered" >        if (!/([^\s])/.test($scope.firstName) || !/([^\s])/.test($scope.lastName) || !/([^\s])/.test($scope.institute)) {</span>
<span class="cstat-no" title="statement not covered" >          Materialize.toast('All fields are required.', 4000);</span>
<span class="cstat-no" title="statement not covered" >          return false;</span>
        } else {
<span class="cstat-no" title="statement not covered" >          $scope.email = $scope.email.trim();</span>
<span class="cstat-no" title="statement not covered" >          $scope.firstName = $scope.firstName.trim();</span>
<span class="cstat-no" title="statement not covered" >          $scope.lastName = $scope.lastName.trim();</span>
<span class="cstat-no" title="statement not covered" >          $scope.institute = $scope.institute.trim();</span>
<span class="cstat-no" title="statement not covered" >          $timeout(<span class="fstat-no" title="function not covered" >function() {</span></span>
<span class="cstat-no" title="statement not covered" >            $scope.$apply();</span>
          });
<span class="cstat-no" title="statement not covered" >          return true;</span>
        }
      }
&nbsp;
      /**
       * @ngdoc function
       * @name daiictSenTeam13App.controller:RegisterCtrl#signup
       * @methodOf daiictSenTeam13App.controller:RegisterCtrl
       * @description
       * Function called when user clicks on sign up in the /register
       * view. It first checks if all input fields are valid using the
       * validate function of this controller. If validate function
       * returns true, the following checks are performed:
       * 1. If emailId has already been used for registration
       * 2. If given email address is in a valid email address format.
       * If either of the above two conditions occur, an error toast message
       * is displayed and the new user is not created. Else, a new user is
       * created and the profile data is stored in the database following which
       * a confirmation email is sent to the registered user with a temporary
       * password for him to login and confirm his email address and account.
       * @returns {undefined} Does not return anything.
       */
<span class="cstat-no" title="statement not covered" >      self.signup = <span class="fstat-no" title="function not covered" >function() {</span></span>
<span class="cstat-no" title="statement not covered" >        if (validate()) {</span>
<span class="cstat-no" title="statement not covered" >          $scope.loading = true;</span>
<span class="cstat-no" title="statement not covered" >          ref.createUser({</span>
            email: $scope.email,
            password: password
          }, <span class="fstat-no" title="function not covered" >function(error) {</span>
<span class="cstat-no" title="statement not covered" >            if (error) {</span>
<span class="cstat-no" title="statement not covered" >              switch (error.code) {</span>
                case "EMAIL_TAKEN":
<span class="cstat-no" title="statement not covered" >                  Materialize.toast("The new user account cannot be created because the email is already in use.", 4000);</span>
<span class="cstat-no" title="statement not covered" >                  break;</span>
                case "INVALID_EMAIL":
<span class="cstat-no" title="statement not covered" >                  Materialize.toast("The specified email is not a valid email.", 4000);</span>
<span class="cstat-no" title="statement not covered" >                  break;</span>
                default:
<span class="cstat-no" title="statement not covered" >                  Materialize.toast("Error creating user. Try again later", 4000);</span>
<span class="cstat-no" title="statement not covered" >                  $location.path('/');</span>
<span class="cstat-no" title="statement not covered" >                  $timeout(<span class="fstat-no" title="function not covered" >function() {</span></span>
<span class="cstat-no" title="statement not covered" >                    $scope.$apply();</span>
                  });
              }
            } else {
<span class="cstat-no" title="statement not covered" >              var profileData = {};</span>
&nbsp;
              // var instituteKey = ref.child('institutions').push().key();
              // profileData['/institutions/' + instituteKey] = {
              //   id: 'daiict',
              //   name: 'Dhirubhai Ambani Institute of Information and Communication Technology',
              //   createOn: Firebase.ServerValue.TIMESTAMP
              // };
&nbsp;
<span class="cstat-no" title="statement not covered" >              var userKey = ref.child('users').push().key();</span>
<span class="cstat-no" title="statement not covered" >              profileData['/users/' + userKey] = {</span>
                email: $scope.email,
                firstName: $scope.firstName,
                lastName: $scope.lastName,
                type: $scope.userType,
                activated: false
              };
&nbsp;
<span class="cstat-no" title="statement not covered" >              var profileKey = ref.child('profile').push().key();</span>
<span class="cstat-no" title="statement not covered" >              profileData['/profile/' + profileKey] = {</span>
                email: $scope.email,
                firstName: $scope.firstName,
                lastName: $scope.lastName,
                type: $scope.userType
              };
&nbsp;
<span class="cstat-no" title="statement not covered" >              ref.update(profileData, <span class="fstat-no" title="function not covered" >function(error) {</span></span>
<span class="cstat-no" title="statement not covered" >                if (error) {</span>
<span class="cstat-no" title="statement not covered" >                  Materialize.toast('Cannot create profile', 4000);</span>
                  //TODO remove user
                } else {
<span class="cstat-no" title="statement not covered" >                  $scope.loading = false;</span>
<span class="cstat-no" title="statement not covered" >                  $location.path('/');</span>
<span class="cstat-no" title="statement not covered" >                  Materialize.toast('Password sent to the email.', 4000);</span>
<span class="cstat-no" title="statement not covered" >                  $timeout(<span class="fstat-no" title="function not covered" >function() {</span></span>
<span class="cstat-no" title="statement not covered" >                    $scope.$apply();</span>
                  });
                }
              });
<span class="cstat-no" title="statement not covered" >              sendPassword($scope.email);</span>
            }
          });
        }
      };
    }]);
})();
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Apr 13 2016 14:01:25 GMT+0530 (IST)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
